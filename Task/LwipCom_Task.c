/***************************************************************************************************
*FileName：LwipCom_Task
*Description：LWIP通用任务
*Author：xsx
*Data：2016年3月9日16:28:12
***************************************************************************************************/

/***************************************************************************************************/
/******************************************头文件***************************************************/
/***************************************************************************************************/

#include	"LwipCom_Task.h"
#include	"LwIPConfig.h"
#include 	"stm32f4x7_eth_bsp.h"
#include 	"netconf.h"

#include	"MyMem.h"

#include 	"FreeRTOS.h"
#include 	"task.h"

/***************************************************************************************************/
/**************************************局部变量声明*************************************************/
/***************************************************************************************************/

#define LwipComTask_PRIORITY			2			//看门狗任务优先级
const char * LwipComTaskName = "vLwipComTask";		//看门狗任务名

/***************************************************************************************************/
/**************************************局部函数声明*************************************************/
/***************************************************************************************************/

static void vLwipComTask( void *pvParameters );	//看门狗任务

/***************************************************************************************************/
/***************************************************************************************************/
/***************************************正文********************************************************/
/***************************************************************************************************/
/***************************************************************************************************/
/***************************************************************************************************/

/***************************************************************************************************
*FunctionName：StartvSysLedTask
*Description：建立系统指示灯任务
*Input：None
*Output：None
*Author：xsx
*Data：2015年8月26日16:58:13
***************************************************************************************************/
void StartvLwipComTask(void * pram)
{
	xTaskCreate( vLwipComTask, LwipComTaskName, configMINIMAL_STACK_SIZE, pram, LwipComTask_PRIORITY, NULL );
}

/***************************************************************************************************
*FunctionName：vSysLedTask
*Description：系统指示灯闪烁表面程序正常运行
*Input：None
*Output：None
*Author：xsx
*Data：2015年8月26日16:58:46
***************************************************************************************************/
static void vLwipComTask( void *pvParameters )
{
	struct netif * tempnetif = (struct netif *)pvParameters;
	
	while(1)
	{
		SetGB_LinkState(ReadPHYLinkState());

		if((Link_Down == GetGB_LinkState())&&(netif_is_link_up(tempnetif)))
		{
			netif_set_link_down(tempnetif);
			SetGB_NetCard(Line_Mode);//NetNone);
		}
		else if((Link_Up == GetGB_LinkState())&&(!netif_is_link_up(tempnetif)))
		{
			netif_set_link_up(tempnetif);
			SetGB_NetCard(Line_Mode);
		}
		/* wait 250 ms */
		vTaskDelay(1000 / portTICK_RATE_MS);
	}   
}


